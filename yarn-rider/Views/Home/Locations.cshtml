@using yarn_rider.Models
@model IList<yarn_rider.Models.User>

@{
    ViewBag.Title = "Locations";
    Layout = "~/Views/Shared/_LayoutMap.cshtml";

    SiteDbContext db = new SiteDbContext();
    int[] countriesArr =
    {
        db.Users.Count(u => u.Country == Country.Israel),
        db.Users.Count(u => u.Country == Country.UnitedStates),
        db.Users.Count(u => u.Country == Country.Australia),
        db.Users.Count(u => u.Country == Country.Brazil),
        db.Users.Count(u => u.Country == Country.Italy),
        db.Users.Count(u => u.Country == Country.Thailand),
        db.Users.Count(u => u.Country == Country.Japan),
        db.Users.Count(u => u.Country == Country.SouthAfrica)
    };
}


<head>
    <title>yarn - Locations</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        width: 100%;
        height: 100vh;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      
      #content {
      margin-left: 0.5rem;
      margin-top: 0.5rem;
      magin-bottom: 0.1rem;
      }
      
    </style>

</head>
<body>


<div class="position-absolute" style="margin-left:11rem; margin-top:4rem; z-index:100">
    <h2>yarn HQ Locations</h2>
</div>


<div id="map"></div>
<script>

                var map;
                var InforObj = [];
                var centerCords = {
                    lat: 0,
                    lng: 40
               
                };
               
                
                var markersOnMap = [{
                        placeName: "Israel",
                        LatLng: [{
                            lat: 31.47,
                            lng: 35.12
                        }]
                    },
                    {
                        placeName: "UnitedStates",
                        LatLng: [{
                            lat: 37.09024,
                            lng: -95.712891
                        }]
                    },
                    {
                        placeName: "Australia",
                        LatLng: [{
                            lat: -35.299085,
                            lng: 509.109615
                        }]
                    },
                    {
                        placeName: "Brazil",
                        LatLng: [{
                            lat: -14.235004,
                            lng: -51.92528
                        }]
                    },
                    {
                        placeName: "Italy",
                        LatLng: [{
                            lat: 41.54,
                            lng: 12.29
                        }]
                    },
                    {
                        placeName: "Thailand",
                        LatLng: [{
                            lat: 13.45,
                            lng: 100.35
                        }]
                    },
                    {
                        placeName: "Japan",
                        LatLng: [{
                            lat: 36.204824,
                            lng: 138.252924
                        }]
                    },
                        {
                        placeName: "SouthAfrica",
                        LatLng: [{
                            lat: -30.559482,
                            lng: 22.937506
                        }]
                    }
                ];
        
                window.onload = function () {
                    initMap();
                };
                

                function addMarker() {
            
                        var JScountriesArray = [
                            @countriesArr[0],
                            @countriesArr[1],
                            @countriesArr[2],
                            @countriesArr[3],
                            @countriesArr[4],
                            @countriesArr[5],
                            @countriesArr[6],
                            @countriesArr[7]
                        ];
                   
                    
                    for (var i = 0; i < markersOnMap.length; i++) {
                       
                        var contentString = '<div id="content"><h5>' + 
                                            markersOnMap[i].placeName + 
                                            '</h5>users: ' + '<h5>' +
                                            JScountriesArray[i] + '</h5>' +
                                             '</div>';
                       
      
                                                  
                        const marker = new google.maps.Marker({
                            position: markersOnMap[i].LatLng[0],
                            map: map
                        });
        
                        const infowindow = new google.maps.InfoWindow({
                            content: contentString,
                            maxWidth: 200
                        });
                        
                            infowindow.open(marker.get('map'), marker);
                            InforObj[0] = infowindow;
                            
 
                           

                    }
                    
                }
        
                function closeOtherInfo() {
                    if (InforObj.length > 0) {
                        /* detach the info-window from the marker ... undocumented in the API docs */
                        InforObj[0].set("marker", null);
                        /* and close it */
                        InforObj[0].close();
                        /* blank the array */
                        InforObj.length = 0;
                    }
                }
        
                function initMap() {
                    map = new google.maps.Map(document.getElementById('map'), {
                        zoom: 2,
                        center: centerCords
                    });
                    addMarker();
                }
                
    </script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDoe6Jk2K-NiId2g1IxAqOxf4SewjLCXeY&callback=initMap"
        async defer></script>

<h3>
    @countriesArr[0]
    @countriesArr[1]
    @countriesArr[2]
    @countriesArr[3]
    @countriesArr[4]
    @countriesArr[5]
    @countriesArr[6]
    @countriesArr[7]
</h3>