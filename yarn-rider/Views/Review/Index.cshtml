@using System.Globalization
@using yarn_rider.Models
@model IList<yarn_rider.Models.Review>

@{
    ViewBag.Title = "Reviews";
    User currentUser = (User) Session["currentUser"];
}

<h3>Reviews</h3>
<hr/>


<!-- search by filters -->

@using (Html.BeginForm("Index", "Review", FormMethod.Get))
{
    <div class="row">

        <div class="input-group col-4">
            By Movie Name:
            @Html.TextBox("searchMovieString", null, new {@class = "form-control"})
        </div>

        <div class="input-group col-4">
            By Review Title:
            @Html.TextBox("searchReviewString", null, new {@class = "form-control"})
            
        </div>
        
        @{
            var rates = Enumerable
                .Range(0, 11)
                .Select(rate => new SelectListItem
                {
                    Value = rate.ToString(CultureInfo.InvariantCulture),
                    Text = rate.ToString(CultureInfo.InvariantCulture)
                });
        }

        <div class="form-group col-xs-12 col-md-2 mb-0">
            @Html.DropDownList("searchByRate", rates, "By Rate", new {@class = "form-control"})
        </div>

        <div class="col-2">
            <input type="submit" value="Search" class="btn btn-grey"/>
        </div>
    </div>
}

<hr/>


@for (var i = 0; i < Model.Count; i++)
{
    @:<div class="row justify-content-between align-items-center mb-4 p-0">

    for (var j = 0; j < 2; j++)
    {
        if (i >= Model.Count)
        {
            break;
        }

        <div class="col-5 bg-secondary rounded p-1 m-0 no-gutters">

            <div class="row align-items-center">

                <div class="col-2 pl-4">
                    <div class="ratingCircle m-0">
                        @Model[i].Rating
                    </div>
                </div>

                <div class="col-2">
                    <img class="img-fluid d-block" alt="yarn" style="width: 5rem; height: auto"
                         src="@Model[i].Movie.PosterURL">
                </div>

                <div class="col-8 text-left">

                    <div class="d-inline-block">
                        <img class="img-fluid d-inline" alt="yarn" style="width: 3rem; height: auto"
                             src="@Model[i].User.Avatar">
                        
                        <p class="p-0 m-0" style="color: rgba(142, 143, 157, 0.6);">by: @Html.DisplayFor(model => model[i].User.UserName)</p>
                    </div>
                    <p class="p-0 m-0" style="color: rgba(142, 143, 157, 0.6);">@Model[i].Date</p>
                    <p class="p-0 m-0" style="color: #fff; font-weight: bold"> @Model[i].Title</p>
                    
                    <p class="p-0 m-0 text-primary"> @Model[i].Content</p>
                </div>


            </div>

            @* Admin Only! *@
            @{
                if (currentUser != null && currentUser.Admin)
                {
                    <div class="row">
                        <div class="col" style="color: #907f62;">
                            <hr/>
                            <a href="@Url.Action("Edit", "Review", new {id = Model[i].ReviewID})" class="mr-2">
                                <div class="btn btn-admin col-auto text-right mb-3 ml-2">
                                    <i class="fas fa-pen pr-2"></i>Edit
                                </div>
                            </a>

                            <a href="@Url.Action("Delete", "Review", new {id = Model[i].ReviewID})" class="mr-2">
                                <div class="btn btn-admin col-auto text-right mb-3 ml-2">
                                    <i class="fas fa-trash pr-2"></i>Delete
                                </div>
                            </a>
                        </div>
                    </div>
                }
            }
            
        </div>

        i++;
    }

    i--;

    @:</div>
}